name: Sync YunNan Travel Plan

on:
  push:
    paths:
      - 'YunNan.md'
    branches: [ main, master ]

permissions:
  issues: write

jobs:
  sync-to-issue:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Update Travel Issue
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const path = require('path');
            
            // è¯»å–æ–‡ä»¶å†…å®¹
            const filePath = path.join(process.env.GITHUB_WORKSPACE, 'YunNan.md');
            const content = fs.readFileSync(filePath, 'utf8');
            
            // ä½¿ç”¨ä½ åˆ›å»ºçš„Issueç¼–å·ï¼ˆåº”è¯¥æ˜¯1ï¼‰
            const TARGET_ISSUE_NUMBER = 3;
            
            console.log(`ğŸ”„ æ›´æ–°Issue #${TARGET_ISSUE_NUMBER}...`);
            
            try {
              const response = await github.rest.issues.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: TARGET_ISSUE_NUMBER,
                body: content + `\n\n---\n*è‡ªåŠ¨åŒæ­¥æ—¶é—´: ${new Date().toLocaleString('zh-CN')}*` +
                      `\n*[æŸ¥çœ‹æºæ–‡ä»¶](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/${context.sha}/YunNan.md)*`
              });
              
              console.log(`âœ… æˆåŠŸæ›´æ–°Issue #${TARGET_ISSUE_NUMBER}`);
              console.log(`ğŸ”— Issueé“¾æ¥: ${response.data.html_url}`);
              
            } catch (error) {
              console.error(`âŒ æ›´æ–°å¤±è´¥: ${error.message}`);
              if (error.status === 404) {
                console.log('ğŸ’¡ Issueä¸å­˜åœ¨ï¼Œè¯·æ‰‹åŠ¨åˆ›å»ºç¬¬ä¸€ä¸ªIssue');
                console.log('1. å»ä»“åº“ç‚¹å‡»Issues â†’ New Issue');
                console.log('2. åˆ›å»ºæ ‡é¢˜ä¸º"äº‘å—æ—…è¡Œè®¡åˆ’"çš„Issue');
                console.log('3. æ›´æ–°å·¥ä½œæµä¸­çš„Issueç¼–å·');
              }
              throw error;
            }
          github-token: ${{ secrets.GITHUB_TOKEN }}
